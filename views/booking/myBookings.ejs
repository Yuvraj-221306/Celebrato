<% layout("/layouts/boilerplate") %>

<h2 class="mb-4">My Bookings</h2>

<% if (bookings.length === 0) { %>
  <div class="d-flex justify-content-center align-items-center" style="height: 200px;">
    <p class="text-danger fw-bold fs-5">You have no bookings yet.</p>
  </div>
<% } else { %>
  <div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1 mt-3"
       style="background-color: #f8f9fa; padding: 2rem; border-radius: 1rem;">
    <% bookings.forEach(booking => { %>
      <a href="/listings/<%= booking.listing ? booking.listing._id : '#' %>" class="listing-link"
         style="text-decoration: none;">
        <div class="card col listing-card" style="background: transparent; border: none;">
          <% if (booking.listing && booking.listing.images && booking.listing.images.length > 0) { %>
            <img src="<%= booking.listing.images[0].url %>" class="card-img-top" alt="listing_image"
                 style="height: 15rem; object-fit: cover;">
          <% } %>
          <div class="card-body" style="color: #333;">
            <p class="card-text">
              <%= booking.listing ? booking.listing.title : "Listing Deleted" %><br>
              &#8377; <%= booking.listing ? booking.listing.price.toLocaleString("en-IN") : "N/A" %> 
            </p>
            <p class="card-text">
              <strong>Name:</strong> <%= booking.name || 'N/A' %><br>
              <strong>Email:</strong> <%= booking.email || 'N/A' %><br>
              <strong>Contact:</strong> <%= booking.contact || 'N/A' %><br>
              <strong>Start Date:</strong> <%= booking.startDate ? booking.startDate.toDateString() : 'N/A' %><br>
              <strong>End Date:</strong> <%= booking.endDate ? booking.endDate.toDateString() : 'N/A' %><br>
              <strong>Status:</strong>
              <% if (booking.status === "confirmed") { %>
                <span class="badge bg-success">Confirmed</span>
              <% } else if (booking.status === "cancelled") { %>
                <span class="badge bg-danger">Cancelled</span>
              <% } else { %>
                <span class="badge bg-secondary"><%= booking.status %></span>
              <% } %>
              <br>
              <small>Booked on: <%= booking.createdAt ? booking.createdAt.toDateString() : "N/A" %></small>
            </p>
          </div>
        </div>
      </a>
    <% }) %>
  </div>
<% } %>
